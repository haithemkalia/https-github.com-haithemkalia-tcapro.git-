{% extends "base.html" %}

{% block title %}حذف جميع العملاء - نظام تتبع التأشيرات{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <!-- Header -->
            <div class="card border-danger mb-4">
                <div class="card-header bg-danger text-white text-center">
                    <h3 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        تحذير: حذف جميع العملاء
                    </h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger" role="alert">
                        <h5 class="alert-heading">
                            <i class="fas fa-skull-crossbones me-2"></i>
                            عملية خطيرة وغير قابلة للتراجع!
                        </h5>
                        <p class="mb-0">
                            أنت على وشك حذف <strong>{{ total_clients }}</strong> عميل من النظام نهائياً.
                            هذه العملية ستؤدي إلى:
                        </p>
                        <ul class="mt-3 mb-0">
                            <li>حذف جميع بيانات العملاء ({{ total_clients }} عميل)</li>
                            <li>حذف جميع سجلات تاريخ الحالات</li>
                            <li>إعادة تعيين معرفات العملاء إلى الصفر</li>
                            <li><strong>لا يمكن التراجع عن هذه العملية!</strong></li>
                        </ul>
                    </div>
                    
                    {% if total_clients > 0 %}
                    <!-- Confirmation Form -->
                    <form method="POST" id="deleteForm" class="mt-4">
                        <div class="row">
                            <div class="col-12">
                                <div class="mb-4">
                                    <label for="confirmation" class="form-label fw-bold text-danger">
                                        <i class="fas fa-keyboard me-1"></i>
                                        للتأكيد، اكتب النص التالي بالضبط:
                                        <code class="bg-dark text-warning p-1 rounded">DELETE_ALL_CLIENTS</code>
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-lg" 
                                           id="confirmation" 
                                           name="confirmation" 
                                           placeholder="اكتب DELETE_ALL_CLIENTS هنا..."
                                           required
                                           autocomplete="off">
                                    <div class="form-text text-muted">
                                        يجب كتابة النص بالأحرف الإنجليزية الكبيرة والشرطات السفلية
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <button type="submit" 
                                        class="btn btn-danger btn-lg w-100" 
                                        id="deleteBtn"
                                        disabled>
                                    <i class="fas fa-trash-alt me-2"></i>
                                    حذف جميع العملاء ({{ total_clients }})
                                </button>
                            </div>
                            <div class="col-md-6 mb-3">
                                <a href="{{ url_for('clients_list') }}" 
                                   class="btn btn-secondary btn-lg w-100">
                                    <i class="fas fa-times me-2"></i>
                                    إلغاء والعودة
                                </a>
                            </div>
                        </div>
                    </form>
                    {% else %}
                    <!-- No Clients Message -->
                    <div class="text-center py-5">
                        <i class="fas fa-users-slash fa-5x text-muted mb-3"></i>
                        <h4 class="text-muted">لا توجد عملاء في النظام</h4>
                        <p class="text-muted">النظام فارغ بالفعل من العملاء</p>
                        <a href="{{ url_for('clients_list') }}" class="btn btn-primary">
                            <i class="fas fa-arrow-right me-2"></i>
                            العودة إلى قائمة العملاء
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Statistics Card -->
            {% if total_clients > 0 %}
            <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar me-2"></i>
                        إحصائيات النظام الحالية
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <div class="border rounded p-3">
                                <h3 class="text-primary mb-1">{{ total_clients }}</h3>
                                <small class="text-muted">إجمالي العملاء</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="border rounded p-3">
                                <h3 class="text-info mb-1">∞</h3>
                                <small class="text-muted">سجلات التاريخ</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="border rounded p-3">
                                <h3 class="text-warning mb-1">100%</h3>
                                <small class="text-muted">نسبة الحذف</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Enable/disable delete button based on confirmation text
document.getElementById('confirmation').addEventListener('input', function() {
    const confirmationText = this.value.trim();
    const deleteBtn = document.getElementById('deleteBtn');
    
    if (confirmationText === 'DELETE_ALL_CLIENTS') {
        deleteBtn.disabled = false;
        deleteBtn.classList.remove('btn-danger');
        deleteBtn.classList.add('btn-success');
        deleteBtn.innerHTML = '<i class="fas fa-check me-2"></i>تأكيد الحذف ({{ total_clients }} عميل)';
    } else {
        deleteBtn.disabled = true;
        deleteBtn.classList.remove('btn-success');
        deleteBtn.classList.add('btn-danger');
        deleteBtn.innerHTML = '<i class="fas fa-trash-alt me-2"></i>حذف جميع العملاء ({{ total_clients }})';
    }
});

// Confirmation dialog before submission
document.getElementById('deleteForm').addEventListener('submit', function(e) {
    const confirmed = confirm(
        'هل أنت متأكد من حذف جميع العملاء؟\n\n' +
        'سيتم حذف {{ total_clients }} عميل نهائياً!\n\n' +
        'هذه العملية غير قابلة للتراجع!'
    );
    
    if (!confirmed) {
        e.preventDefault();
    }
});
</script>
{% endblock %}