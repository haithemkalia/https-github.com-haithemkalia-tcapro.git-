<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø§Øª</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="/static/css/styles.fd3d584b206e4d6370ba.css" rel="stylesheet">
    
    
</head>
<body>
    <div class="overlay" id="loadingOverlay"></div>
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
        </div>
    </div>

    <div class="main-container">
        <nav class="navbar navbar-expand-lg navbar-custom">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">
                    ğŸ›‚ Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø§Øª
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link " href="/">
                                <i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/clients">
                                <i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/client/add">
                                <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/import-excel">
                                <i class="fas fa-file-excel"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/unrestricted-import">
                                <i class="fas fa-rocket"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø´Ø§Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù‚ÙŠÙˆØ¯
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/settings">
                                <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                            </a>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="https://facebook.com/yourpage" target="_blank">
                                <i class="fab fa-facebook"></i> ØµÙØ­Ø© Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        
            
        

        <div class="content-area">
            
<div class="container-fluid">
 <div class="row mb-4">
 <div class="col-12">
  <div class="card card-modern">
  <div class="card-header-modern">
   <div class="row align-items-center">
   <div class="col">
    <h2 class="mb-0">
    <i class="fas fa-users me-2"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
    </h2>
    <p class="mb-0 mt-2 opacity-75">Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
   </div>
   <div class="col-auto">
    <a href="/client/add" class="btn btn-success-custom">
    <i class="fas fa-plus me-2"></i>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
    </a>
   </div>
   </div>
  </div>
  </div>
 </div>
 </div>

 <div class="row mb-4">
 <div class="col-12">
  <div class="card card-modern">
  <div class="card-body">
   <form method="GET" action="/clients" class="row g-3">
   <div class="col-lg-4 col-md-6">
    <label for="search" class="form-label">
    <i class="fas fa-search me-1"></i>Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ
    </label>
    <input type="text" class="form-control" id="search" name="search" 
      value="" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ...">
   </div>
   
   <div class="col-lg-2 col-md-6">
    <label for="status" class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©</label>
    <select class="form-select" id="status" name="status">
    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
    
    <option value="ØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… ÙÙŠ Ø§Ù„Ø³ÙŠØ³ØªØ§Ù…" >
     ØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… ÙÙŠ Ø§Ù„Ø³ÙŠØ³ØªØ§Ù…
    </option>
    
    <option value="ØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙØ§Ø±Ø©" >
     ØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙØ§Ø±Ø©
    </option>
    
    <option value="ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©" >
     ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©
    </option>
    
    <option value="Ø§Ù„ØªØ£Ø´ÙŠØ±Ø© ØºÙŠØ± Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§" >
     Ø§Ù„ØªØ£Ø´ÙŠØ±Ø© ØºÙŠØ± Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§
    </option>
    
    </select>
   </div>
   
   <div class="col-lg-2 col-md-6">
    <label for="nationality" class="form-label">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</label>
    <select class="form-select" id="nationality" name="nationality">
    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù†Ø³ÙŠØ§Øª</option>
    
    <option value="ØªÙˆÙ†Ø³" >
     ØªÙˆÙ†Ø³
    </option>
    
    <option value="Ù…ØºØ±Ø¨" >
     Ù…ØºØ±Ø¨
    </option>
    
    <option value="Ø¬Ø²Ø§Ø¦Ø±" >
     Ø¬Ø²Ø§Ø¦Ø±
    </option>
    
    </select>
   </div>
   
   <div class="col-lg-2 col-md-6">
    <label for="employee" class="form-label">Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
    <select class="form-select" id="employee" name="employee">
    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>
    
    <option value="Ù…ÙˆØ¸Ù 1" >
     Ù…ÙˆØ¸Ù 1
    </option>
    
    <option value="Ù…ÙˆØ¸Ù 2" >
     Ù…ÙˆØ¸Ù 2
    </option>
    
    </select>
   </div>
   
   <div class="col-lg-2 col-md-6 d-flex align-items-end">
    <button type="submit" class="btn btn-primary-custom w-100">
    <i class="fas fa-search me-1"></i>Ø¨Ø­Ø«
    </button>
   </div>
   
   <div class="col-lg-2 col-md-6 d-flex align-items-end">
    <a href="/clients?per_page=all" class="btn btn-info-custom w-100">
    <i class="fas fa-list me-1"></i>Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
    </a>
   </div>
   
   <div class="col-lg-2 col-md-6 d-flex align-items-end">
    <button type="button" class="btn btn-success-custom w-100" onclick="exportToExcel()">
    <i class="fas fa-file-excel me-1"></i>ØªØµØ¯ÙŠØ± Ø¥ÙƒØ³Ù„
    </button>
   </div>
   </form>
  </div>
  </div>
 </div>
 </div>

 <div class="row">
 <div class="col-12">
  <div class="card card-modern">
  <div class="card-body">
   
   <div class="text-center py-5">
    <i class="fas fa-users fa-3x text-muted mb-3"></i>
    <h4 class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h4>
    <p class="text-muted">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ† Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
   </div>
   
  </div>
  </div>
  </div>
 </div>
</div>

<!-- Pagination -->


<script>
// JavaScript pour l'Ã©dition en ligne
document.addEventListener('DOMContentLoaded', function() {
 initializeInlineEditing();
});

function initializeInlineEditing() {
 const containers = document.querySelectorAll('.inline-edit-container');
 containers.forEach(container => {
 const display = container.querySelector('.inline-edit-display');
 const input = container.querySelector('.inline-edit-input');
 const editIcon = container.querySelector('.edit-icon');
 
 if (display && input && editIcon) {
  display.addEventListener('click', function(e) {
  e.stopPropagation();
  activateInlineEdit(container);
  });
  
  editIcon.addEventListener('click', function(e) {
  e.stopPropagation();
  activateInlineEdit(container);
  });
  
  if (input.tagName === 'SELECT') {
  input.addEventListener('change', function() {
   saveInlineEdit(container);
  });
  } else if (input.tagName === 'INPUT') {
  input.addEventListener('blur', function() {
   saveInlineEdit(container);
  });
  input.addEventListener('keydown', function(e) {
   if (e.key === 'Enter') {
   saveInlineEdit(container);
   } else if (e.key === 'Escape') {
   cancelInlineEdit(container);
   }
  });
  }
 }
 });
}

function activateInlineEdit(container) {
 const display = container.querySelector('.inline-edit-display');
 const input = container.querySelector('.inline-edit-input');
 
 if (display && input) {
 display.style.display = 'none';
 input.style.display = 'block';
 input.focus();
 }
}

function saveInlineEdit(container) {
 const field = container.dataset.field;
 const clientId = container.dataset.clientId;
 const input = container.querySelector('.inline-edit-input');
 const value = input.value;
 
 if (!value && input.tagName !== 'SELECT') {
 cancelInlineEdit(container);
 return;
 }
 
 // Afficher le loading
 showInlineEditLoading(container);
 
 // Envoyer la requÃªte
 fetch(`/api/client/${clientId}/update-field`, {
 method: 'POST',
 headers: {
  'Content-Type': 'application/json',
 },
 body: JSON.stringify({
  field: field,
  value: value
 })
 })
 .then(response => response.json())
 .then(data => {
 if (data.success) {
  updateInlineEditDisplay(container, value);
  showInlineEditMessage(container, 'ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­', 'success');
 } else {
  showInlineEditMessage(container, 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: ' + data.message, 'error');
  cancelInlineEdit(container);
 }
 })
 .catch(error => {
 showInlineEditMessage(container, 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message, 'error');
 cancelInlineEdit(container);
 });
}

function cancelInlineEdit(container) {
 const display = container.querySelector('.inline-edit-display');
 const input = container.querySelector('.inline-edit-input');
 
 if (display && input) {
 display.style.display = 'block';
 input.style.display = 'none';
 }
}

function updateInlineEditDisplay(container, value) {
 const fieldValue = container.querySelector('.field-value');
 if (fieldValue) {
 fieldValue.textContent = value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
 }
}

function showInlineEditLoading(container) {
 const display = container.querySelector('.inline-edit-display');
 if (display) {
 display.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
 }
}

function showInlineEditMessage(container, message, type) {
 const display = container.querySelector('.inline-edit-display');
 if (display) {
 const className = type === 'success' ? 'text-success' : 'text-danger';
 display.innerHTML = `<span class="${className}">${message}</span>`;
 
 setTimeout(() => {
  const fieldValue = container.querySelector('.field-value');
  if (fieldValue) {
  display.innerHTML = fieldValue.outerHTML + '<i class="fas fa-edit edit-icon"></i>';
  }
 }, 2000);
 }
}

// Fonction pour supprimer un client avec confirmation avancÃ©e
function deleteClient(clientId) {
 // RÃ©cupÃ©rer les informations du client pour la confirmation
 const row = event.target.closest('tr');
 const clientName = row.querySelector('td:nth-child(2)').textContent.trim();
 const clientPhone = row.querySelector('td:nth-child(3)').textContent.trim();
 
 // Message de confirmation dÃ©taillÃ©
 const confirmMessage = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ

ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:
â€¢ Ø§Ù„Ù…Ø¹Ø±Ù: ${clientId}
â€¢ Ø§Ù„Ø§Ø³Ù…: ${clientName}
â€¢ Ø§Ù„Ù‡Ø§ØªÙ: ${clientPhone}

âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!

Ø§ÙƒØªØ¨ "Ø­Ø°Ù" Ù„Ù„ØªØ£ÙƒÙŠØ¯:`;
 
 // Demander confirmation avec input
 const userInput = prompt(confirmMessage);
 
 if (userInput !== 'Ø­Ø°Ù') {
  if (userInput !== null) {
   alert('âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø°Ù - Ù„Ù… ØªÙƒØªØ¨ "Ø­Ø°Ù"');
  }
  return;
 }
 
 // Afficher le loading
 const button = event.target.closest('button');
 const originalContent = button.innerHTML;
 button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø­Ø°Ù...';
 button.disabled = true;
 
 // CrÃ©er un formulaire pour la suppression
 const form = document.createElement('form');
 form.method = 'POST';
 form.action = `/client/delete/${clientId}`;
 
 // Ajouter le formulaire au DOM et le soumettre
 document.body.appendChild(form);
 form.submit();
}

// Fonction pour envoyer un message WhatsApp de test
function sendWhatsAppTest(clientId) {
 if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')) {
 return;
 }
 
 // Afficher le loading
 const button = event.target.closest('button');
 const originalContent = button.innerHTML;
 button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
 button.disabled = true;
 
 // Envoyer la requÃªte
 fetch(`/api/client/${clientId}/send-whatsapp`, {
 method: 'POST',
 headers: {
  'Content-Type': 'application/json',
 }
 })
 .then(response => response.json())
 .then(data => {
 if (data.success) {
  alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ“± Ø§Ù„Ø±Ù‚Ù…: ' + data.phone_number + '\nğŸ“‹ Ø§Ù„Ø­Ø§Ù„Ø©: ' + data.status);
 } else {
  alert('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ' + data.message);
 }
 })
 .catch(error => {
 alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message);
 })
 .finally(() => {
 // Restaurer le bouton
 button.innerHTML = originalContent;
 button.disabled = false;
 });
}

// Fonction pour exporter vers Excel
function exportToExcel() {
 // RÃ©cupÃ©rer les paramÃ¨tres de recherche actuels
 const searchParams = new URLSearchParams(window.location.search);
 const search = searchParams.get('search') || '';
 const status = searchParams.get('status') || '';
 const nationality = searchParams.get('nationality') || '';
 const employee = searchParams.get('employee') || '';
 
 // Construire l'URL d'export avec les paramÃ¨tres
 let exportUrl = '/export/excel';
 const params = [];
 
 if (search) params.push(`search=${encodeURIComponent(search)}`);
 if (status) params.push(`status=${encodeURIComponent(status)}`);
 if (nationality) params.push(`nationality=${encodeURIComponent(nationality)}`);
 if (employee) params.push(`employee=${encodeURIComponent(employee)}`);
 
 if (params.length > 0) {
  exportUrl += '?' + params.join('&');
 }
 
 // Ouvrir le lien de tÃ©lÃ©chargement dans un nouvel onglet
 window.open(exportUrl, '_blank');
}
</script>

        </div>

        <footer class="footer-custom">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Ø´Ø±ÙƒØ© ØªØ³Ù‡ÙŠÙ„ Ù„Ù„Ø®Ø¯Ù…Ø§Øª</h5>
                        <p class="mb-0">Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ø­Ù„ÙˆÙ„ Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ£Ø´ÙŠØ±Ø§Øª</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0">
                            <i class="fas fa-phone"></i> Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª: Ø§ØªØµÙ„ Ø¨Ù†Ø§
                        </p>
                        <p class="mb-0">
                            <i class="fab fa-facebook"></i>
                            <a href="https://facebook.com/yourpage" target="_blank" class="text-white text-decoration-none">
                                ØªØ§Ø¨Ø¹ÙˆÙ†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ
                            </a>
                        </p>
                    </div>
                </div>
                <hr class="my-3">
                <div class="text-center">
                    <small>&copy; 2024 Ø´Ø±ÙƒØ© ØªØ³Ù‡ÙŠÙ„ Ù„Ù„Ø®Ø¯Ù…Ø§Øª. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</small>
                </div>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/main.460c3cc42f56ecfb91fc.js"></script>
    <script src="/static/js/dashboard.2e6f3d486f5269e9ca88.js"></script>
    
    
</body>
</html>